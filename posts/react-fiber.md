---
title: '「中文」前端面试八股 --React Fiber（纯文字说明）'
date: '2023-05-13'
---

## Fiber  是什么

React 16 中引入的新的协调机制，主要是为了**不阻塞主线程的情况下提高 React 渲染性能**。

## 为什么有 Fiber

在旧的协调机制中，React 使用 **DFS算法** 来更新虚拟 DOM 树，并且执行一系列的更新操作确保 UI 的最新状态，但这意味着**更新操作的执行将会一直维护着当前线程的执行权，就无法中断和恢复**。这样会导致 React 频繁更新的时候，页面会变得卡顿和无响应，因此 Fiber 应运而生。

## Fiber 的基本思想

在 Fiber 的协调机制中，React 引入了一种时间片机制，将更新操作划分为多个小任务，每次只执行一小部分工作，然后将执行权交还给主线程，让页面保持响应。如果后续事件触发，需要**中断当前的更新操作，也可以通过时间片机制快速中断正在执行的任务，并进行状态恢复**。

## Fiber 的基本实现

Fiber 的基本实现就是**通过一个 Fiber 树来记录所有组件的状态和更新操作，将虚拟 DOM 的遍历拆分为多个阶段，在每个阶段中通过组建树的 Fiber 节点来协调更新任务的执行**。

React 会为每个代码块分配一个唯一 ID，称为 Fiber Node。每个 Fiber 节点是一个轻量级对象，它对应着组件树的一个组件，包含该组件的状态、Friendly Name、指向父级 Fiber 节点的指针，以及其他一些与协调算法相关的属性。根据 Fiber 树的结构，React 可以很容易地理解和控制虚拟 DOM 的更新操作。

## 其他 Fiber 相关

除此之外，Fiber 还提供了一些新的 API 和功能，如 `React.lazy()`、`React.memo()`等等，可以实现更加精细和搞笑的组件更新和显示。

## 总结

Fiber 是一种新的 React 协调机制，主要解决了旧协调机制中下沉的更新操作影响页面响应的问题，并且提供了更高效实用的 API 和功能。

Fiber 的实现和原理都比较复杂深奥，但只要掌握了其核心思想，就能够更好地理解和使用 React 库。
